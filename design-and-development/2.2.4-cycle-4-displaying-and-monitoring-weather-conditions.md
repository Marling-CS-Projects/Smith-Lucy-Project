# 2.2.4 Cycle 4: Displaying and Monitoring Weather Conditions

## Design

In previous sections, I have designed a weather station to take readings from the environment, which then uploads to a database. These weather readings are then accessed by a user interface, which are displayed in the history section of the app.&#x20;

In this cycle, I am going to use this data to monitor weather conditions. The app will display current weather conditions, including temperature, pressure and humidity. Data can also be used to show the trends in conditions, in the form of a graph.

### Objectives

* [ ] Display current readings for weather conditions on the user interface
* [ ] Monitor weather conditions over time in the form of graphs
* [ ] Display other basic information on the user interface
* [ ] Complete settings and about section of user interface

### Usability Features

I need to ensure that any data displayed visually on my user interface is effective and engaging. Data must be presented in a way that is meaningful to the user, such as graphs and tables. The user interface will also need to be error tolerant, and be able to deal with missing data readings.

### Tests I need to conduct

| ID  | Test                                                                                                                                                     | Description | Pass Criteria |
| --- | -------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- | ------------- |
| 4.1 | Display the most recent readings stored in the database on the user interface.                                                                           |             |               |
| 4.2 | Display current readings for all the data collected by the weather station, such as temperature, pressure and air quality.                               |             |               |
| 4.3 | Visually display trends in data, e.g. graphs and tables.                                                                                                 |             |               |
| 4.4 | Display any other basic information, such as the time since the last reading and the time the weather station was first activated on the user interface. |             |               |
| 4.5 | Settings options                                                                                                                                         |             |               |

## Data structures

| Structure Name | Structure Type | Description |
| -------------- | -------------- | ----------- |
|                |                |             |
|                |                |             |
|                |                |             |

## Development

### 4.1

In this part of the cycle I am going to design a program that displays the most recent weather readings stored on the database. However, first I need to ensure the data the user interface displays is updated regularly. Currently, the node.js back-end connects to mongoDB once, and waits for a request from the front-end. In order to keep this data accurate, the app must update at regular intervals, and the data should be retrieved for the database after every request. Firstly, I altered the server.js file to wait for a request from the front-end.

```javascript
//Server listens for requests on port 8000
app.listen(8000, () => {
    console.log(`Server is running on port 8000.`);
  });

// Access database module
async function getDatabaseReadings(){

    var myData = await database
    console.log(myData);

    return myData
}

async function collectData(){

    app.get('/weatherData', (req, res) =>{

        //Responds once data has been recieved
        myData = getDatabaseReadings().then(function(myData){
            res.json({ weatherData: myData})
        })
        
    });
}

collectData();
```

<figure><img src="../.gitbook/assets/Screenshot 2023-08-04 at 18.55.35.png" alt="" width="344"><figcaption></figcaption></figure>

As expected, the server connected to mongoDB without requesting any data. After refreshing the app, the database sent a request to the database, printing the data in the terminal as shown below. The weather data was then displayed on the user interface.

<figure><img src="../.gitbook/assets/Screenshot 2023-08-04 at 18.58.45.png" alt="" width="563"><figcaption></figcaption></figure>

However, once the database had been updated with new weather data, the back-end did not retrieve the new data from mongoDB, and was therefore not displayed on the app. This would mean I couldn't display current conditions without restarting the server each time. To resolve this, I adapted my database.js module to export the function to collect data from the database itself, instead of just the data values. This meant that new data was collected after every request.&#x20;

```javascript
//Added to database.js file
module.exports = {run}

//Added to server.js file
var myData = await database.run()
```

As expected, this allowed new data to be displayed on the react app without requiring the back-end to restart. However, after refreshing the app again, I recieved the following error.

<figure><img src="../.gitbook/assets/Screenshot 2023-08-07 at 10.48.09.png" alt="" width="563"><figcaption></figcaption></figure>

After going through and debugging my code, I realised that the cause of this error was due to a schema repeatedly being defined every time the run() function is called. I removed the schema from the function so that it would instead only be run once when the module is exported. This resolved the issue and allowed me to refresh the app multiple times without error. This test has therefore passed.

The next step is to ensure that the front-end app does not need to be manually refreshed to recieve the most recent weather conditions. Instead, it should automatically update its components.

### 4.2

Having displayed the values for the most recent readings on the user interface, I am now going to focus on each reading individually, making sure it is updated with additional readings

### 4.3

Previously, I have designed a program that displays current readings on the user interface. In this section, I am going to visually show the trends in weather data, allowing the user to monitor their environment more closely.&#x20;

### 4.4

In this section, I am going to improve the functionality of the user interface by displaying basic infomation about the data, such as when it was last updated.

### 4.5

Finally, I am going to focus on the settings section of my user interface.



### Outcome



### Testing

| Test | Instructions | What I expect | What actually happened | Pass/Fail |
| ---- | ------------ | ------------- | ---------------------- | --------- |
|      |              |               |                        |           |
|      |              |               |                        |           |
|      |              |               |                        |           |

### Challenges



### Evidence
